<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Diagnostic | BloomELearning âœ¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<header>
  <div class="container">
    <div class="logo">BloomELearning âœ¨</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="phonics.html">Phonics</a></li>
        <li><a href="reading.html">Reading</a></li>
        <li><a href="math.html">Math</a></li>
        <li><a href="progress.html">My Progress</a></li>
        <li><a href="parent.html">Parent Resources</a></li>
      </ul>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h1>ðŸ§  Diagnostic Test</h1>
    <p>For 2nd grade and older. Quick skill check with recommendations.</p>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="section-title">Start Diagnostic</h2>

    <div class="game-box">
      <div class="kid-big">Choose level:</div>
      <div class="grade-row">
        <button class="select" data-level="2-3">2ndâ€“3rd Grade</button>
        <button class="select" data-level="4plus">4th Grade+</button>
      </div>

      <div id="quiz" style="margin-top:20px;"></div>

      <div class="game-row">
        <button class="btn secondary" id="readBtn" disabled>ðŸ”Š Read Question</button>
        <button class="btn secondary" id="prevBtn" disabled>â¬… Prev</button>
        <button class="btn secondary" id="nextBtn" disabled>Next âž¡</button>
      </div>

      <div class="game-row">
        <button class="btn" id="submitBtn" disabled>Submit</button>
        <button class="btn secondary" id="resetBtn" disabled>Reset</button>
      </div>

      <div id="results" style="margin-top:16px;"></div>
    </div>
  </div>
</section>

<footer>Â© 2026 BloomELearning âœ¨ | Made with ðŸ’š</footer>

<script>
  const bank_2_3 = [
    { domain:"Word Skills", q:"Which word has a long A sound?", options:["rain","ran","ring"], correct:0 },
    { domain:"Word Skills", q:"Which word has an r-controlled vowel?", options:["car","cake","cap"], correct:0 },
    { domain:"Reading", q:"Read: 'Sam packed a lunch for a field trip.' Why did Sam pack lunch?", options:["Field trip","Bedtime","Dinner party"], correct:0 },
    { domain:"Reading", q:"Read: 'Maya wore a coat and mittens outside.' The weather is probablyâ€¦", options:["Cold","Hot","Rainy and warm"], correct:0 },
    { domain:"Math", q:"47 + 18 = ?", options:["65","55","75"], correct:0 },
    { domain:"Math", q:"56 - 29 = ?", options:["27","37","25"], correct:0 }
  ];

  const bank_4plus = [
    { domain:"Word Skills", q:"Which word has a prefix meaning 'again'?", options:["redo","happy","played"], correct:0 },
    { domain:"Word Skills", q:"Which word contains a silent letter?", options:["knight","kite","kit"], correct:0 },
    { domain:"Reading", q:"Read: 'Ella forgot her homework, so she wrote it in her planner.' What lesson did she learn?", options:["Use a planner","Skip homework","Lose papers"], correct:0 },
    { domain:"Reading", q:"Read: 'The main character felt nervous before the speech.' Nervous meansâ€¦", options:["Worried","Sleepy","Hungry"], correct:0 },
    { domain:"Math", q:"326 + 187 = ?", options:["513","413","503"], correct:0 },
    { domain:"Math", q:"72 Ã· 8 = ?", options:["9","8","7"], correct:0 }
  ];

  let level = null;
  let questions = [];
  let currentIndex = 0;
  let answers = {};

  const quizEl = document.getElementById("quiz");
  const resultsEl = document.getElementById("results");
  const readBtn = document.getElementById("readBtn");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const submitBtn = document.getElementById("submitBtn");
  const resetBtn = document.getElementById("resetBtn");

  function speak(text){
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 1; u.pitch = 1.02;
    window.speechSynthesis.speak(u);
  }

  readBtn.onclick = () => {
    if (!questions.length) return;
    const q = questions[currentIndex];
    speak(`${q.domain}. Question ${currentIndex+1}. ${q.q}`);
  };

  function render(){
    const q = questions[currentIndex];
    quizEl.innerHTML = `
      <div style="font-weight:900; margin-bottom:10px;">
        ${q.domain} â€¢ Question ${currentIndex+1} of ${questions.length}
      </div>
      <div style="font-size:20px; font-weight:900; margin-bottom:12px;">
        ${q.q}
      </div>
      <div class="game-row" id="opts"></div>
      <div class="small" style="margin-top:10px;">Answered: ${Object.keys(answers).length}/${questions.length}</div>
    `;

    const opts = document.getElementById("opts");
    q.options.forEach((opt, idx) => {
      const b = document.createElement("button");
      b.className = "pill";
      b.textContent = opt;

      if (answers[currentIndex] === idx) {
        b.style.background = "rgba(58,143,107,0.10)";
      }

      b.onclick = () => {
        answers[currentIndex] = idx;
        render();
        updateButtons();
      };
      opts.appendChild(b);
    });

    updateButtons();
  }

  function updateButtons(){
    prevBtn.disabled = currentIndex === 0;
    nextBtn.disabled = currentIndex === questions.length - 1;
    submitBtn.disabled = Object.keys(answers).length !== questions.length;
  }

  prevBtn.onclick = () => { if (currentIndex>0){ currentIndex--; render(); } };
  nextBtn.onclick = () => { if (currentIndex<questions.length-1){ currentIndex++; render(); } };

  submitBtn.onclick = () => {
    let correct = 0;
    const totals = {};
    const corr = {};

    questions.forEach((q,i)=>{
      totals[q.domain] = (totals[q.domain]||0)+1;
      corr[q.domain] = corr[q.domain]||0;
      if (answers[i] === q.correct){ correct++; corr[q.domain]++; }
    });

    const percent = Math.round((correct/questions.length)*100);

    const lines = Object.keys(totals).map(d=>{
      const p = Math.round((corr[d]/totals[d])*100);
      return `â€¢ ${d}: ${p}%`;
    }).join("<br>");

    const payload = { level, percent, correct, total: questions.length, ts: new Date().toISOString() };
    localStorage.setItem("bloom_diagnostic_latest", JSON.stringify(payload));

    resultsEl.innerHTML = `
      <div class="status">Score: ${correct}/${questions.length} (${percent}%)</div>
      <div style="margin-top:10px; line-height:1.6;">
        <strong>By skill:</strong><br>${lines}
      </div>
      <div style="margin-top:10px;">
        Next: try <a href="phonics.html">Phonics</a>, <a href="reading.html">Reading</a>, or <a href="math.html">Math</a>.
      </div>
    `;
  };

  resetBtn.onclick = () => {
    answers = {};
    currentIndex = 0;
    resultsEl.innerHTML = "";
    render();
  };

  function start(lvl){
    level = lvl;
    questions = (level === "2-3") ? bank_2_3 : bank_4plus;
    answers = {};
    currentIndex = 0;

    readBtn.disabled = false;
    prevBtn.disabled = false;
    nextBtn.disabled = false;
    resetBtn.disabled = false;

    render();
  }

  document.querySelectorAll(".select").forEach(btn=>{
    btn.onclick = () => start(btn.getAttribute("data-level"));
  });
</script>

</body>
</html>
