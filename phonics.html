<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Phonics | BloomELearning âœ¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

<header>
  <div class="container">
    <div class="logo">BloomELearning âœ¨</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>

        <li class="dropdown">
          <a href="#">Subjects</a>
          <div class="dropdown-menu">
            <a href="phonics.html">ğŸ”¤ Phonics</a>
            <a href="reading.html">ğŸ“– Reading</a>
            <a href="math.html">â• Math</a>
            <a href="letter-formation.html">âœï¸ Letter Tracing</a>
          </div>
        </li>

        <li class="dropdown">
          <a href="#">Resources</a>
          <div class="dropdown-menu">
            <a href="resources.html">ğŸ¥ Kids Resources</a>
            <a href="parent-resources.html">ğŸ§‘â€ğŸ« Parent Resources</a>
            <a href="standards.html">ğŸ“˜ Standards (Kâ€“2)</a>
          </div>
        </li>

        <li class="dropdown">
          <a href="#">Student</a>
          <div class="dropdown-menu">
            <a href="student-login.html">ğŸ§’ Student Login</a>
            <a href="progress.html">ğŸ“Š My Progress</a>
            <a href="sticker-book.html">ğŸ“– Sticker Book</a>
          </div>
        </li>

        <li><a href="games.html">ğŸ® Games</a></li>
        <li><a href="diagnostic.html">ğŸ§  Diagnostic</a></li>
      </ul>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h1>Phonics Playground ğŸ”¤ğŸŒ¿</h1>
    <p>Pick a game: match sounds, label pictures, build silly words, or read decodable stories!</p>
    <div class="quick-strip">
      <a class="btn secondary" href="progress.html">My Progress</a>
      <a class="btn secondary" href="sticker-book.html">Sticker Book</a>
    </div>
    <div class="hero-note">Kâ€“2 practice: letter names, letter sounds, blending, and decodable reading</div>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="section-title">Choose a Phonics Game ğŸŒŸ</h2>

    <div class="game-box wide">
      <div class="grid-3">
        <div class="card">
          <h3>ğŸ§  Diagnostic</h3>
          <p>Letter names + sounds. Then it recommends practice.</p>
          <button class="btn" id="showDiagBtn">Start</button>
        </div>

        <div class="card">
          <h3>ğŸ§ Sound â†’ Letter</h3>
          <p>Hear the sound. Tap the letter card.</p>
          <button class="btn" id="showSoundToLetterBtn">Play</button>
        </div>

        <div class="card">
          <h3>ğŸ”¤ Letter â†’ Sound</h3>
          <p>See the letter. Choose the sound card.</p>
          <button class="btn" id="showLetterToSoundBtn">Play</button>
        </div>

        <div class="card">
          <h3>ğŸ–¼ï¸ Label the Picture</h3>
          <p>Pick the word that matches the picture AND starts with the sound.</p>
          <button class="btn" id="showLabelPicBtn">Play</button>
        </div>

        <div class="card">
          <h3>ğŸ§ª Nonsense Word Lab</h3>
          <p>Swap vowels to make safe silly words (no bad words).</p>
          <button class="btn" id="showNonsenseBtn">Play</button>
        </div>

        <div class="card">
          <h3>ğŸ“š Decodable Reading</h3>
          <p>Short phonics-friendly stories + a quick question.</p>
          <button class="btn" id="showDecodableBtn">Read</button>
        </div>
      </div>
    </div>

    <!-- Grade pick -->
    <div class="game-box" style="margin-top:18px;">
      <p class="kid-big" style="margin-bottom:10px;">Pick a Grade</p>
      <div class="badge-row">
        <button class="pill active" data-grade="K">Kindergarten</button>
        <button class="pill" data-grade="1">Grade 1</button>
        <button class="pill" data-grade="2">Grade 2</button>
      </div>
      <p class="small" style="margin-top:10px;">Tip: Keep the same grade so games stay â€œjust right.â€</p>
    </div>

    <!-- DIAGNOSTIC -->
    <div class="game-box wide" id="diagPanel" style="margin-top:18px; display:none;">
      <p class="kid-big">Diagnostic âœ…</p>
      <p class="small">Answer letter <strong>name</strong> and <strong>sound</strong> questions. Tap ğŸ”Š to hear it.</p>

      <div class="game-box" style="margin-top:12px;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px;">
          <p class="kid-big" id="diagQ" style="margin:0; flex:1;">Press â€œTake Diagnosticâ€ to begin.</p>
          <button class="btn secondary" id="diagSpeakBtn" title="Play sound" aria-label="Play sound">ğŸ”Š</button>
        </div>

        <p class="small" id="diagHint"></p>
        <p class="small" id="diagAudioStatus" style="display:none;"></p>

        <div class="grid-3" id="diagChoices" style="margin-top:14px;"></div>
        <p class="kid-big" id="diagResult" style="margin-top:14px;"></p>

        <div class="quick-strip">
          <button class="btn" id="goDiagBtn">Take Diagnostic</button>
          <button class="btn secondary" id="diagNextBtn">Next</button>
          <button class="btn secondary" id="diagSkipBtn">Skip</button>
          <button class="btn secondary" id="retakeBtn">Retake</button>
          <button class="btn secondary" id="closeDiagBtn">Close</button>
        </div>

        <p class="small" style="margin-top:8px;">
          After the diagnostic, try the recommended mini game.
        </p>
      </div>
    </div>

    <!-- RECOMMENDED GAME -->
    <div class="game-box wide" id="targetGamePanel" style="margin-top:18px; display:none;">
      <p class="kid-big">Recommended Mini Game ğŸ®</p>
      <p class="small" id="gamePlan">Your game is based on your diagnostic.</p>

      <div class="game-box" style="margin-top:12px;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px;">
          <p class="kid-big" id="gameQ" style="margin:0; flex:1;">Game question loads hereâ€¦</p>
          <button class="btn secondary" id="gameSpeakBtn" title="Play sound" aria-label="Play sound">ğŸ”Š</button>
        </div>

        <p class="small" id="gameHint"></p>
        <p class="small" id="gameAudioStatus" style="display:none;"></p>

        <div class="grid-3" id="gameChoices" style="margin-top:14px;"></div>
        <p class="kid-big" id="gameResult" style="margin-top:14px;"></p>

        <div class="quick-strip">
          <button class="btn" id="goGameBtn">Go</button>
          <button class="btn secondary" id="gameNextBtn">Next</button>
          <button class="btn secondary" id="resetStarsBtn">Reset Stars</button>
          <button class="btn secondary" id="closeTargetGameBtn">Close</button>
        </div>
      </div>
    </div>

    <!-- GAME: Sound -> Letter -->
    <div class="game-box wide" id="soundToLetterPanel" style="margin-top:18px; display:none;">
      <p class="kid-big">ğŸ§ Sound â†’ Letter Match</p>
      <p class="small">Press ğŸ”Š. Then tap the correct letter(s).</p>

      <div class="game-box" style="margin-top:12px;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px;">
          <p class="kid-big" id="stlQ" style="margin:0; flex:1;">Press Play to start!</p>
          <button class="btn secondary" id="stlSpeakBtn" aria-label="Play sound">ğŸ”Š</button>
        </div>

        <p class="small" id="stlHint"></p>
        <p class="small" id="stlAudioStatus" style="display:none;"></p>

        <div class="grid-3" id="stlChoices" style="margin-top:14px;"></div>
        <p class="kid-big" id="stlResult" style="margin-top:14px;"></p>

        <div class="quick-strip">
          <button class="btn" id="stlStartBtn">Play</button>
          <button class="btn secondary" id="stlNextBtn">Next</button>
          <button class="btn secondary" id="closeStlBtn">Close</button>
        </div>
      </div>
    </div>

    <!-- GAME: Letter -> Sound -->
    <div class="game-box wide" id="letterToSoundPanel" style="margin-top:18px; display:none;">
      <p class="kid-big">ğŸ”¤ Letter â†’ Sound Match</p>
      <p class="small">Tap a sound card to hear it. Use ğŸ”Š to hear the letter name again.</p>

      <div class="game-box" style="margin-top:12px;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px;">
          <p class="kid-big" id="ltsQ" style="margin:0; flex:1;">Press Play to start!</p>
          <button class="btn secondary" id="ltsSpeakBtn" aria-label="Play letter name">ğŸ”Š</button>
        </div>

        <p class="small" id="ltsHint"></p>
        <p class="small" id="ltsAudioStatus" style="display:none;"></p>

        <div class="grid-3" id="ltsChoices" style="margin-top:14px;"></div>
        <p class="kid-big" id="ltsResult" style="margin-top:14px;"></p>

        <div class="quick-strip">
          <button class="btn" id="ltsStartBtn">Play</button>
          <button class="btn secondary" id="ltsNextBtn">Next</button>
          <button class="btn secondary" id="closeLtsBtn">Close</button>
        </div>
      </div>
    </div>

    <!-- NEW GAME: Label the Picture -->
    <div class="game-box wide" id="labelPicPanel" style="margin-top:18px; display:none;">
      <p class="kid-big">ğŸ–¼ï¸ Label the Picture</p>
      <p class="small">Pick the word that matches the picture AND starts with the sound. Press ğŸ”Š to hear the sound.</p>

      <div class="game-box" style="margin-top:12px;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px;">
          <p class="kid-big" id="lpQ" style="margin:0; flex:1;">Press Play to start!</p>
          <button class="btn secondary" id="lpSpeakBtn" aria-label="Play sound">ğŸ”Š</button>
        </div>

        <p class="small" id="lpHint"></p>
        <p class="small" id="lpAudioStatus" style="display:none;"></p>

        <div class="grid-3" id="lpChoices" style="margin-top:14px;"></div>
        <p class="kid-big" id="lpResult" style="margin-top:14px;"></p>

        <div class="quick-strip">
          <button class="btn" id="lpStartBtn">Play</button>
          <button class="btn secondary" id="lpNextBtn">Next</button>
          <button class="btn secondary" id="closeLpBtn">Close</button>
        </div>
      </div>
    </div>

    <!-- NEW GAME: Nonsense Word Lab -->
    <div class="game-box wide" id="nonsensePanel" style="margin-top:18px; display:none;">
      <p class="kid-big">ğŸ§ª Nonsense Word Lab</p>
      <p class="small">
        Build a silly word by swapping the vowel. Tap ğŸ”Š to hear each sound youâ€™re using.
      </p>

      <div class="game-box" style="margin-top:12px;">
        <p class="kid-big" id="nwWord" style="margin:0;">Press â€œMake a Wordâ€!</p>
        <p class="small" id="nwHint">Pick a vowel button to change the middle sound.</p>
        <p class="small" id="nwStatus" style="display:none;"></p>

        <div class="quick-strip" style="margin-top:12px;">
          <button class="btn" id="nwMakeBtn">Make a Word</button>
          <button class="btn secondary" id="nwPlayC1Btn">ğŸ”Š Start</button>
          <button class="btn secondary" id="nwPlayVBtn">ğŸ”Š Vowel</button>
          <button class="btn secondary" id="nwPlayC2Btn">ğŸ”Š End</button>
        </div>

        <div class="badge-row" style="margin-top:12px;">
          <button class="pill" data-v="a">a</button>
          <button class="pill" data-v="e">e</button>
          <button class="pill" data-v="i">i</button>
          <button class="pill" data-v="o">o</button>
          <button class="pill" data-v="u">u</button>
        </div>

        <div class="quick-strip" style="margin-top:12px;">
          <button class="btn" id="nwCheckBtn">Is it a real word?</button>
          <button class="btn secondary" id="closeNwBtn">Close</button>
        </div>

        <p class="small" id="nwRealCheck" style="margin-top:10px;"></p>
      </div>
    </div>

    <!-- NEW: Decodable reading -->
    <div class="game-box wide" id="decodablePanel" style="margin-top:18px; display:none;">
      <p class="kid-big">ğŸ“š Decodable Reading</p>
      <p class="small">Choose a short story. Tap ğŸ”Š to have it read aloud (optional).</p>

      <div class="game-box" style="margin-top:12px;">
        <div class="quick-strip">
          <button class="btn" id="decPickBtn">Pick a Story</button>
          <button class="btn secondary" id="decReadBtn">ğŸ”Š Read Aloud</button>
          <button class="btn secondary" id="decStopBtn">â¹ Stop</button>
          <button class="btn secondary" id="closeDecBtn">Close</button>
        </div>

        <div style="margin-top:12px;">
          <p class="kid-big" id="decTitle" style="margin:0;">Press â€œPick a Storyâ€</p>
          <p class="small" id="decFocus"></p>
          <div class="game-box" style="margin-top:10px;">
            <p id="decText" style="margin:0; font-size:18px; line-height:1.6;"></p>
          </div>
        </div>

        <div class="game-box" style="margin-top:12px;">
          <p class="kid-big" id="decQ" style="margin:0;">Question:</p>
          <div class="grid-3" id="decChoices" style="margin-top:12px;"></div>
          <p class="kid-big" id="decResult" style="margin-top:12px;"></p>
        </div>
      </div>
    </div>

  </div>
</section>

<footer>Â© 2026 BloomELearning âœ¨ | Made with ğŸ’š</footer>

<script>
  // ---------- Storage Keys ----------
  const PROG_KEY = "bloom_progress";
  const PHONICS_DIAG_KEY = "bloom_phonics_diag";

  // ---------- Helpers ----------
  function load(key, fallback) {
    try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
    catch { return fallback; }
  }
  function save(key, obj) {
    localStorage.setItem(key, JSON.stringify(obj));
  }
  function shuffle(arr){
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }
  function hideAllPanels(){
    diagPanel.style.display = "none";
    targetGamePanel.style.display = "none";
    soundToLetterPanel.style.display = "none";
    letterToSoundPanel.style.display = "none";
    labelPicPanel.style.display = "none";
    nonsensePanel.style.display = "none";
    decodablePanel.style.display = "none";
  }
  function showPanel(el){
    hideAllPanels();
    el.style.display = "block";
    el.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  // ---------- Stars ----------
  function addPhonicsStar(){
    const p = load(PROG_KEY, {
      phonicsStars:0, readingStars:0, mathStars:0, tracingDone:0, gamesStars:0, diagnosticScore:null
    });
    p.phonicsStars = (p.phonicsStars || 0) + 1;
    save(PROG_KEY, p);
  }

  // ---------- Audio ----------
  const audio = new Audio();
  audio.preload = "auto";

  function showAudioStatus(el, msg){
    if (!el) return;
    el.style.display = "block";
    el.textContent = msg;
    clearTimeout(el._t);
    el._t = setTimeout(()=>{ el.style.display = "none"; }, 2000);
  }
  async function playAudio(src, statusEl){
    try {
      audio.pause();
      audio.currentTime = 0;
      audio.src = src;
      await audio.play();
    } catch {
      showAudioStatus(statusEl, "Audio not found. Check filename + folder path.");
    }
  }

  // Your real mp3 files (assets/)
  const soundAudio = {
    "m": "./assets/audio/sounds/m.mp3",
    "s": "./assets/audio/sounds/s.mp3",
    "t": "./assets/audio/sounds/t.mp3",
    "sh": "./assets/audio/sounds/sh.mp3",
    "ch": "./assets/audio/sounds/ch.mp3",
    "th": "./assets/audio/sounds/th.mp3",
    "long-a": "./assets/audio/sounds/long-a.mp3",
    "long-e": "./assets/audio/sounds/long-e.mp3",
    "long-o": "./assets/audio/sounds/long-o.mp3"
  };
  const letterAudio = {
    "A": "./assets/audio/letters/A.mp3",
    "M": "./assets/audio/letters/M.mp3",
    "S": "./assets/audio/letters/S.mp3",
    "B": "./assets/audio/letters/B.mp3",
    "R": "./assets/audio/letters/R.mp3",
    "T": "./assets/audio/letters/T.mp3",
    "G": "./assets/audio/letters/G.mp3",
    "P": "./assets/audio/letters/P.mp3",
    "V": "./assets/audio/letters/V.mp3"
  };

  // Speech (for decodable read-aloud)
  function speakText(text){
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 0.9;
    u.pitch = 1.1;
    window.speechSynthesis.speak(u);
  }
  function stopSpeak(){
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
  }

  // ---------- Grade selection ----------
  let grade = "K";
  function renderGradeButtons(){
    document.querySelectorAll(".pill[data-grade]").forEach(btn=>{
      btn.classList.toggle("active", btn.dataset.grade === grade);
    });
  }
  document.querySelectorAll(".pill[data-grade]").forEach(btn=>{
    btn.onclick = ()=>{
      grade = btn.dataset.grade;
      renderGradeButtons();
      resetUI();
    };
  });

  // ---------- Banks ----------
  const gradeBanks = {
    "K": {
      nameItems: [
        { letter:"A", correct:"A", choices:["A","B","D"] },
        { letter:"M", correct:"M", choices:["N","M","W"] },
        { letter:"S", correct:"S", choices:["S","C","G"] }
      ],
      soundItems: [
        { soundKey:"m", correct:"M", choices:["M","S","T"], hint:"/m/ like moon" },
        { soundKey:"s", correct:"S", choices:["B","S","D"], hint:"/s/ like sun" },
        { soundKey:"t", correct:"T", choices:["T","A","P"], hint:"/t/ like top" }
      ],
      labelPics: [
        { soundKey:"m", picture:"ğŸŒ™", answer:"moon", choices:["moon","sun","top"], hint:"Starts with /m/" },
        { soundKey:"s", picture:"â˜€ï¸", answer:"sun", choices:["sun","moon","top"], hint:"Starts with /s/" },
        { soundKey:"t", picture:"ğŸ©", answer:"top", choices:["top","sun","moon"], hint:"Starts with /t/" }
      ]
    },
    "1": {
      nameItems: [
        { letter:"B", correct:"B", choices:["B","D","P"] },
        { letter:"R", correct:"R", choices:["R","K","H"] },
        { letter:"T", correct:"T", choices:["T","F","E"] }
      ],
      soundItems: [
        { soundKey:"sh", correct:"SH", choices:["CH","SH","TH"], hint:"SH like ship" },
        { soundKey:"ch", correct:"CH", choices:["CH","PH","WH"], hint:"CH like chop" },
        { soundKey:"th", correct:"TH", choices:["TH","SH","CH"], hint:"TH like this" }
      ],
      labelPics: [
        { soundKey:"sh", picture:"ğŸš¢", answer:"ship", choices:["ship","chop","this"], hint:"Starts with /sh/" },
        { soundKey:"ch", picture:"ğŸª“", answer:"chop", choices:["this","ship","chop"], hint:"Starts with /ch/" },
        { soundKey:"th", picture:"ğŸ‘", answer:"this", choices:["chop","this","ship"], hint:"Starts with /th/" }
      ]
    },
    "2": {
      nameItems: [
        { letter:"G", correct:"G", choices:["G","J","Q"] },
        { letter:"P", correct:"P", choices:["P","R","B"] },
        { letter:"V", correct:"V", choices:["V","W","Y"] }
      ],
      soundItems: [
        { soundKey:"long-a", correct:"AI", choices:["AI","OA","EE"], hint:"Long A like rain" },
        { soundKey:"long-e", correct:"EE", choices:["EE","OO","AI"], hint:"Long E like feet" },
        { soundKey:"long-o", correct:"OA", choices:["OA","EE","AI"], hint:"Long O like boat" }
      ],
      labelPics: [
        { soundKey:"long-a", picture:"ğŸŒ§ï¸", answer:"rain", choices:["rain","feet","boat"], hint:"Has long A (ai/ay)" },
        { soundKey:"long-e", picture:"ğŸ¦¶", answer:"feet", choices:["boat","rain","feet"], hint:"Has long E (ee/ea)" },
        { soundKey:"long-o", picture:"â›µ", answer:"boat", choices:["feet","boat","rain"], hint:"Has long O (oa/ow)" }
      ]
    }
  };

  // ---------- Panel refs ----------
  const diagPanel = document.getElementById("diagPanel");
  const targetGamePanel = document.getElementById("targetGamePanel");
  const soundToLetterPanel = document.getElementById("soundToLetterPanel");
  const letterToSoundPanel = document.getElementById("letterToSoundPanel");
  const labelPicPanel = document.getElementById("labelPicPanel");
  const nonsensePanel = document.getElementById("nonsensePanel");
  const decodablePanel = document.getElementById("decodablePanel");

  // Activity buttons
  document.getElementById("showDiagBtn").onclick = ()=> showPanel(diagPanel);
  document.getElementById("showSoundToLetterBtn").onclick = ()=> showPanel(soundToLetterPanel);
  document.getElementById("showLetterToSoundBtn").onclick = ()=> showPanel(letterToSoundPanel);
  document.getElementById("showLabelPicBtn").onclick = ()=> showPanel(labelPicPanel);
  document.getElementById("showNonsenseBtn").onclick = ()=> showPanel(nonsensePanel);
  document.getElementById("showDecodableBtn").onclick = ()=> showPanel(decodablePanel);

  document.getElementById("closeDiagBtn").onclick = hideAllPanels;
  document.getElementById("closeTargetGameBtn").onclick = hideAllPanels;
  document.getElementById("closeStlBtn").onclick = hideAllPanels;
  document.getElementById("closeLtsBtn").onclick = hideAllPanels;
  document.getElementById("closeLpBtn").onclick = hideAllPanels;
  document.getElementById("closeNwBtn").onclick = hideAllPanels;
  document.getElementById("closeDecBtn").onclick = ()=>{ stopSpeak(); hideAllPanels(); };

  // ---------- Reset UI ----------
  function resetUI(){
    // diag
    diagQEl.textContent = "Press â€œTake Diagnosticâ€ to begin.";
    diagHintEl.textContent = "";
    diagChoicesEl.innerHTML = "";
    diagResultEl.textContent = "";
    // recommended
    gamePlanEl.textContent = "Your game is based on your diagnostic.";
    gameQEl.textContent = "Game question loads hereâ€¦";
    gameHintEl.textContent = "";
    gameChoicesEl.innerHTML = "";
    gameResultEl.textContent = "";
    // STL
    stlQ.textContent = "Press Play to start!";
    stlHint.textContent = "";
    stlChoices.innerHTML = "";
    stlResult.textContent = "";
    // LTS
    ltsQ.textContent = "Press Play to start!";
    ltsHint.textContent = "";
    ltsChoices.innerHTML = "";
    ltsResult.textContent = "";
    // Label pic
    lpQ.textContent = "Press Play to start!";
    lpHint.textContent = "";
    lpChoices.innerHTML = "";
    lpResult.textContent = "";
    // Nonsense
    nwWord.textContent = "Press â€œMake a Wordâ€!";
    nwRealCheck.textContent = "";
    // Decodable
    decTitle.textContent = "Press â€œPick a Storyâ€";
    decFocus.textContent = "";
    decText.textContent = "";
    decQ.textContent = "Question:";
    decChoices.innerHTML = "";
    decResult.textContent = "";
  }

  // =========================================================
  // 1) DIAGNOSTIC + RECOMMENDED GAME
  // =========================================================
  let diagQs = [];
  let diagIndex = 0;
  let diagCorrect = 0;
  let diagMissed = [];
  let lastDiagQ = null;

  let gameQs = [];
  let gameIndex = 0;
  let lastGameQ = null;

  const diagQEl = document.getElementById("diagQ");
  const diagHintEl = document.getElementById("diagHint");
  const diagChoicesEl = document.getElementById("diagChoices");
  const diagResultEl = document.getElementById("diagResult");
  const diagAudioStatus = document.getElementById("diagAudioStatus");

  const gamePlanEl = document.getElementById("gamePlan");
  const gameQEl = document.getElementById("gameQ");
  const gameHintEl = document.getElementById("gameHint");
  const gameChoicesEl = document.getElementById("gameChoices");
  const gameResultEl = document.getElementById("gameResult");
  const gameAudioStatus = document.getElementById("gameAudioStatus");

  function buildDiagnostic(gr){
    const b = gradeBanks[gr];

    const nameQs = b.nameItems.map(x => ({
      type:"name",
      letter: x.letter,
      prompt:`What is the NAME of this letter: ${x.letter}?`,
      hint:"Tap ğŸ”Š to hear the letter name.",
      correct:x.correct,
      choices:shuffle(x.choices),
      focusKey:`name:${x.letter}`
    }));

    const soundQs = b.soundItems.map(x => ({
      type:"sound",
      soundKey: x.soundKey,
      prompt:`Which letter(s) make this sound?`,
      hint:`Tap ğŸ”Š to hear the sound.`,
      correct:x.correct,
      choices:shuffle(x.choices),
      focusKey:`sound:${x.correct}`
    }));

    return shuffle([...nameQs, ...soundQs]);
  }

  function buildRecommendedGame(gr, missedFocusKeys){
    const b = gradeBanks[gr];

    const nameQs = b.nameItems.map(x => ({
      type:"name",
      letter: x.letter,
      prompt:`Letter NAME: ${x.letter} is calledâ€¦`,
      hint:"Tap ğŸ”Š to hear the letter name.",
      correct:x.correct,
      choices:shuffle(x.choices),
      focusKey:`name:${x.letter}`
    }));

    const soundQs = b.soundItems.map(x => ({
      type:"sound",
      soundKey: x.soundKey,
      prompt:`Letter SOUND: Which letter(s) make this sound?`,
      hint:"Tap ğŸ”Š to hear the sound.",
      correct:x.correct,
      choices:shuffle(x.choices),
      focusKey:`sound:${x.correct}`
    }));

    const pool = [...nameQs, ...soundQs];
    const missed = pool.filter(q => missedFocusKeys.includes(q.focusKey));
    const rest   = pool.filter(q => !missedFocusKeys.includes(q.focusKey));

    const game = [];
    while (game.length < 10) {
      if (missed.length) game.push(missed.shift());
      else game.push(rest[game.length % rest.length]);
    }
    return game;
  }

  function renderDiagQuestion(){
    const q = diagQs[diagIndex];
    lastDiagQ = q;

    diagQEl.textContent = q.prompt;
    diagHintEl.textContent = q.hint || "";
    diagResultEl.textContent = "";
    diagChoicesEl.innerHTML = "";

    q.choices.forEach(c=>{
      const card = document.createElement("div");
      card.className = "card";
      card.style.textAlign = "center";
      card.innerHTML = `<h3 style="font-size:26px; margin-bottom:6px;">${c}</h3><p class="small">Tap!</p>`;
      card.onclick = ()=> checkDiagAnswer(c);
      diagChoicesEl.appendChild(card);
    });
  }

  function playDiagAudio(){
    if (!lastDiagQ) return showAudioStatus(diagAudioStatus, "Press Take Diagnostic to start!");
    if (lastDiagQ.type === "name") {
      const src = letterAudio[lastDiagQ.letter];
      if (!src) return showAudioStatus(diagAudioStatus, "Missing letter audio file.");
      playAudio(src, diagAudioStatus);
    } else {
      const src = soundAudio[lastDiagQ.soundKey];
      if (!src) return showAudioStatus(diagAudioStatus, "Missing sound audio file.");
      playAudio(src, diagAudioStatus);
    }
  }

  function checkDiagAnswer(choice){
    if (diagResultEl.textContent) return;
    const q = diagQs[diagIndex];

    if (choice === q.correct){
      diagCorrect++;
      diagResultEl.textContent = "Correct! â­";
      addPhonicsStar();
    } else {
      diagMissed.push(q.focusKey);
      diagResultEl.textContent = `Good try! Answer: ${q.correct}`;
      if (q.type === "sound") playDiagAudio();
    }
  }

  function finishDiagnostic(){
    const total = diagQs.length || 1;
    const score = Math.round((diagCorrect / total) * 100);

    save(PHONICS_DIAG_KEY, { grade, score, missed: diagMissed, date: Date.now() });

    const missedNames = diagMissed.filter(x=>x.startsWith("name:")).length;
    const missedSounds = diagMissed.filter(x=>x.startsWith("sound:")).length;

    let planText = `Diagnostic score: ${score}% â€” `;
    if (missedNames === 0 && missedSounds === 0) planText += "Awesome! Try any game you like.";
    else {
      planText += "Recommended practice: ";
      const parts = [];
      if (missedNames) parts.push(`letter names (${missedNames})`);
      if (missedSounds) parts.push(`letter sounds (${missedSounds})`);
      planText += parts.join(" and ") + ".";
    }
    gamePlanEl.textContent = planText;

    gameQs = buildRecommendedGame(grade, diagMissed);
    gameIndex = 0;
    showPanel(targetGamePanel);
    renderGameQuestion();
  }

  function renderGameQuestion(){
    const q = gameQs[gameIndex % gameQs.length];
    lastGameQ = q;

    gameQEl.textContent = q.prompt;
    gameHintEl.textContent = q.hint || "";
    gameResultEl.textContent = "";
    gameChoicesEl.innerHTML = "";

    q.choices.forEach(c=>{
      const card = document.createElement("div");
      card.className = "card";
      card.style.textAlign = "center";
      card.innerHTML = `<h3 style="font-size:30px; margin-bottom:6px;">${c}</h3><p class="small">Tap!</p>`;
      card.onclick = ()=> checkGameAnswer(c);
      gameChoicesEl.appendChild(card);
    });
  }

  function playGameAudio(){
    if (!lastGameQ) return showAudioStatus(gameAudioStatus, "Start the game first!");
    if (lastGameQ.type === "name") {
      const src = letterAudio[lastGameQ.letter];
      if (!src) return showAudioStatus(gameAudioStatus, "Missing letter audio file.");
      playAudio(src, gameAudioStatus);
    } else {
      const src = soundAudio[lastGameQ.soundKey];
      if (!src) return showAudioStatus(gameAudioStatus, "Missing sound audio file.");
      playAudio(src, gameAudioStatus);
    }
  }

  function checkGameAnswer(choice){
    if (gameResultEl.textContent) return;
    const q = gameQs[gameIndex % gameQs.length];

    if (choice === q.correct){
      gameResultEl.textContent = "Correct! â­";
      addPhonicsStar();
    } else {
      gameResultEl.textContent = "Try again ğŸ™‚";
      if (q.type === "sound") playGameAudio();
    }
  }

  // diag buttons
  document.getElementById("goDiagBtn").onclick = ()=>{
    diagQs = buildDiagnostic(grade);
    diagIndex = 0;
    diagCorrect = 0;
    diagMissed = [];
    renderDiagQuestion();
  };
  document.getElementById("diagNextBtn").onclick = ()=>{
    if (!diagQs.length) return;
    if (!diagResultEl.textContent){
      diagMissed.push(diagQs[diagIndex].focusKey);
    }
    diagIndex++;
    if (diagIndex >= diagQs.length) finishDiagnostic();
    else renderDiagQuestion();
  };
  document.getElementById("diagSkipBtn").onclick = ()=>{
    if (!diagQs.length) return;
    diagMissed.push(diagQs[diagIndex].focusKey);
    diagIndex++;
    if (diagIndex >= diagQs.length) finishDiagnostic();
    else renderDiagQuestion();
  };
  document.getElementById("retakeBtn").onclick = ()=>{
    localStorage.removeItem(PHONICS_DIAG_KEY);
    resetUI();
    alert("Diagnostic cleared. Press â€œTake Diagnosticâ€ to start again!");
  };
  document.getElementById("diagSpeakBtn").onclick = playDiagAudio;

  // recommended game buttons
  document.getElementById("goGameBtn").onclick = ()=>{
    const savedDiag = load(PHONICS_DIAG_KEY, null);
    if (!savedDiag || savedDiag.grade !== grade) {
      alert("Take the diagnostic first for this grade!");
      return;
    }
    gameQs = buildRecommendedGame(grade, savedDiag.missed || []);
    gameIndex = 0;
    showPanel(targetGamePanel);
    renderGameQuestion();
  };
  document.getElementById("gameNextBtn").onclick = ()=>{
    gameIndex++;
    renderGameQuestion();
  };
  document.getElementById("gameSpeakBtn").onclick = playGameAudio;
  document.getElementById("resetStarsBtn").onclick = ()=>{
    const p = load(PROG_KEY, {
      phonicsStars:0, readingStars:0, mathStars:0, tracingDone:0, gamesStars:0, diagnosticScore:null
    });
    p.phonicsStars = 0;
    save(PROG_KEY, p);
    alert("Phonics stars reset!");
  };

  // =========================================================
  // 2) GAME: Sound -> Letter
  // =========================================================
  const stlQ = document.getElementById("stlQ");
  const stlHint = document.getElementById("stlHint");
  const stlChoices = document.getElementById("stlChoices");
  const stlResult = document.getElementById("stlResult");
  const stlAudioStatus = document.getElementById("stlAudioStatus");

  let stlItems = [];
  let stlIndex = 0;
  let stlCurrent = null;

  function buildSoundToLetterGame(gr){
    const b = gradeBanks[gr];
    return shuffle(b.soundItems.map(x => ({
      soundKey: x.soundKey,
      hint: x.hint || "Listen for the sound.",
      correct: x.correct,
      choices: shuffle(x.choices)
    })));
  }

  function renderSTL(){
    stlCurrent = stlItems[stlIndex % stlItems.length];
    stlQ.textContent = "Which letter(s) make this sound?";
    stlHint.textContent = stlCurrent.hint;
    stlResult.textContent = "";
    stlChoices.innerHTML = "";

    stlCurrent.choices.forEach(c=>{
      const card = document.createElement("div");
      card.className = "card";
      card.style.textAlign = "center";
      card.innerHTML = `<h3 style="font-size:30px; margin-bottom:6px;">${c}</h3><p class="small">Tap!</p>`;
      card.onclick = ()=> {
        if (stlResult.textContent) return;
        if (c === stlCurrent.correct) {
          stlResult.textContent = "Correct! â­";
          addPhonicsStar();
        } else {
          stlResult.textContent = "Try again ğŸ™‚";
          playSTLSound();
        }
      };
      stlChoices.appendChild(card);
    });
  }

  function playSTLSound(){
    if (!stlCurrent) return showAudioStatus(stlAudioStatus, "Press Play to start!");
    const src = soundAudio[stlCurrent.soundKey];
    if (!src) return showAudioStatus(stlAudioStatus, "Missing sound audio file.");
    playAudio(src, stlAudioStatus);
  }

  document.getElementById("stlStartBtn").onclick = ()=>{
    stlItems = buildSoundToLetterGame(grade);
    stlIndex = 0;
    renderSTL();
    playSTLSound();
  };
  document.getElementById("stlNextBtn").onclick = ()=>{
    if (!stlItems.length) return;
    stlIndex++;
    renderSTL();
    playSTLSound();
  };
  document.getElementById("stlSpeakBtn").onclick = playSTLSound;

  // =========================================================
  // 3) GAME: Letter -> Sound
  // =========================================================
  const ltsQ = document.getElementById("ltsQ");
  const ltsHint = document.getElementById("ltsHint");
  const ltsChoices = document.getElementById("ltsChoices");
  const ltsResult = document.getElementById("ltsResult");
  const ltsAudioStatus = document.getElementById("ltsAudioStatus");

  let ltsItems = [];
  let ltsIndex = 0;
  let ltsCurrent = null;

  function buildLetterToSoundGame(gr){
    const b = gradeBanks[gr];
    const soundKeys = b.soundItems.map(x => x.soundKey);

    // Only use letters we have letter audio for (so ğŸ”Š works)
    const safeLetters = b.nameItems.filter(n => !!letterAudio[n.letter]);

    return shuffle(safeLetters.map(n => {
      // Choose a "best match" based on grade theme (simple but consistent)
      const defaultMap = {
        "K": { "A":"m", "M":"m", "S":"s" },
        "1": { "B":"ch", "R":"sh", "T":"th" },
        "2": { "G":"long-o", "P":"long-a", "V":"long-e" }
      };
      const correctSoundKey = (defaultMap[gr] && defaultMap[gr][n.letter]) ? defaultMap[gr][n.letter] : soundKeys[0];
      const distractors = shuffle(soundKeys.filter(k=>k!==correctSoundKey)).slice(0,2);
      const options = shuffle([correctSoundKey, ...distractors]);

      return { letter:n.letter, correctSoundKey, options };
    }));
  }

  function renderLTS(){
    ltsCurrent = ltsItems[ltsIndex % ltsItems.length];
    ltsQ.textContent = `Which sound matches this letter: ${ltsCurrent.letter}?`;
    ltsHint.textContent = "Tap a sound card to hear it.";
    ltsResult.textContent = "";
    ltsChoices.innerHTML = "";

    const labelMap = {
      "m":" /m/ ",
      "s":" /s/ ",
      "t":" /t/ ",
      "sh":" /sh/ ",
      "ch":" /ch/ ",
      "th":" /th/ ",
      "long-a":" long A ",
      "long-e":" long E ",
      "long-o":" long O "
    };

    ltsCurrent.options.forEach(soundKey=>{
      const card = document.createElement("div");
      card.className = "card";
      card.style.textAlign = "center";
      card.innerHTML = `<h3 style="font-size:26px; margin-bottom:6px;">${labelMap[soundKey] || soundKey}</h3><p class="small">Tap to hear!</p>`;

      card.onclick = async ()=>{
        const src = soundAudio[soundKey];
        if (!src) return showAudioStatus(ltsAudioStatus, "Missing sound audio file.");
        await playAudio(src, ltsAudioStatus);

        if (ltsResult.textContent) return;
        if (soundKey === ltsCurrent.correctSoundKey) {
          ltsResult.textContent = "Correct! â­";
          addPhonicsStar();
        } else {
          ltsResult.textContent = "Try again ğŸ™‚";
        }
      };

      ltsChoices.appendChild(card);
    });
  }

  function playLTSLetterName(){
    if (!ltsCurrent) return showAudioStatus(ltsAudioStatus, "Press Play to start!");
    const src = letterAudio[ltsCurrent.letter];
    if (!src) return showAudioStatus(ltsAudioStatus, "Missing letter audio file.");
    playAudio(src, ltsAudioStatus);
  }

  document.getElementById("ltsStartBtn").onclick = ()=>{
    ltsItems = buildLetterToSoundGame(grade);
    ltsIndex = 0;
    renderLTS();
    playLTSLetterName();
  };
  document.getElementById("ltsNextBtn").onclick = ()=>{
    if (!ltsItems.length) return;
    ltsIndex++;
    renderLTS();
    playLTSLetterName();
  };
  document.getElementById("ltsSpeakBtn").onclick = playLTSLetterName;

  // =========================================================
  // 4) NEW GAME: Label the Picture
  // =========================================================
  const lpQ = document.getElementById("lpQ");
  const lpHint = document.getElementById("lpHint");
  const lpChoices = document.getElementById("lpChoices");
  const lpResult = document.getElementById("lpResult");
  const lpAudioStatus = document.getElementById("lpAudioStatus");

  let lpItems = [];
  let lpIndex = 0;
  let lpCurrent = null;

  function buildLabelPicGame(gr){
    const b = gradeBanks[gr];
    return shuffle(b.labelPics.map(x => ({
      soundKey: x.soundKey,
      picture: x.picture,
      answer: x.answer,
      choices: shuffle(x.choices),
      hint: x.hint || "Starts with the sound!"
    })));
  }

  function renderLP(){
    lpCurrent = lpItems[lpIndex % lpItems.length];
    lpQ.textContent = `Label this picture: ${lpCurrent.picture}`;
    lpHint.textContent = lpCurrent.hint;
    lpResult.textContent = "";
    lpChoices.innerHTML = "";

    lpCurrent.choices.forEach(w=>{
      const card = document.createElement("div");
      card.className = "card";
      card.style.textAlign = "center";
      card.innerHTML = `<h3 style="font-size:26px; margin-bottom:6px;">${w}</h3><p class="small">Tap!</p>`;
      card.onclick = ()=>{
        if (lpResult.textContent) return;
        if (w === lpCurrent.answer) {
          lpResult.textContent = "Correct! â­";
          addPhonicsStar();
        } else {
          lpResult.textContent = "Try again ğŸ™‚";
          playLPSound();
        }
      };
      lpChoices.appendChild(card);
    });
  }

  function playLPSound(){
    if (!lpCurrent) return showAudioStatus(lpAudioStatus, "Press Play to start!");
    const src = soundAudio[lpCurrent.soundKey];
    if (!src) return showAudioStatus(lpAudioStatus, "Missing sound audio file.");
    playAudio(src, lpAudioStatus);
  }

  document.getElementById("lpStartBtn").onclick = ()=>{
    lpItems = buildLabelPicGame(grade);
    lpIndex = 0;
    renderLP();
    playLPSound();
  };
  document.getElementById("lpNextBtn").onclick = ()=>{
    if (!lpItems.length) return;
    lpIndex++;
    renderLP();
    playLPSound();
  };
  document.getElementById("lpSpeakBtn").onclick = playLPSound;

  // =========================================================
  // 5) NEW GAME: Nonsense Word Lab (safe)
  // =========================================================
  const nwWord = document.getElementById("nwWord");
  const nwHint = document.getElementById("nwHint");
  const nwStatus = document.getElementById("nwStatus");
  const nwRealCheck = document.getElementById("nwRealCheck");

  // A small â€œbad wordâ€ blocklist (we keep it minimal + safe)
  // Add more if you ever notice a problem combo
  const blockedSubstrings = [
    "ass","sex","cum","dick","shit","fuck","bitch","cunt","piss"
  ];

  // Some real words we might accidentally generateâ€”treat as "real"
  const simpleRealWords = new Set([
    "map","sap","tap","tip","top","mop","sip","ship","chip","thin","this"
  ]);

  // Choose consonants that wonâ€™t form accidental bad words easily
  const safeC1 = ["m","s","t","sh","ch","th"];
  const safeC2 = ["p","t","m","s","n"];  // simple endings
  const vowels = ["a","e","i","o","u"];

  let nw = { c1:"m", v:"a", c2:"p" };

  function isBlocked(word){
    const lower = word.toLowerCase();
    return blockedSubstrings.some(b => lower.includes(b));
  }

  function buildNonsenseWord(){
    // Try a few times to avoid blocked combos
    for (let tries=0; tries<30; tries++){
      const c1 = safeC1[Math.floor(Math.random()*safeC1.length)];
      const v  = vowels[Math.floor(Math.random()*vowels.length)];
      const c2 = safeC2[Math.floor(Math.random()*safeC2.length)];
      const w = `${c1}${v}${c2}`;
      if (!isBlocked(w)) {
        nw = { c1, v, c2 };
        return w;
      }
    }
    // fallback if somehow blocked every time
    nw = { c1:"m", v:"a", c2:"p" };
    return "map";
  }

  function showNW(){
    const w = `${nw.c1}${nw.v}${nw.c2}`;
    nwWord.textContent = `Your silly word: ${w}`;
    nwRealCheck.textContent = "";
  }

  function setVowel(v){
    nw.v = v;
    const w = `${nw.c1}${nw.v}${nw.c2}`;
    if (isBlocked(w)) {
      showAudioStatus(nwStatus, "Oops! That one is not allowed. Try a different vowel.");
      // revert to 'a'
      nw.v = "a";
    }
    showNW();
  }

  // Small vowel sound playback using speech (since you don't have vowel mp3s)
  // If you later record vowel sounds, we can switch to mp3 here.
  function speakSoundLabel(label){
    if (!("speechSynthesis" in window)) return;
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(label);
    u.rate = 0.9;
    window.speechSynthesis.speak(u);
  }

  document.getElementById("nwMakeBtn").onclick = ()=>{
    const w = buildNonsenseWord();
    nwWord.textContent = `Your silly word: ${w}`;
    nwHint.textContent = "Now tap a vowel to change the middle sound!";
    nwRealCheck.textContent = "";
  };

  // Play buttons
  document.getElementById("nwPlayC1Btn").onclick = ()=>{
    const key = (nw.c1 === "sh" || nw.c1 === "ch" || nw.c1 === "th") ? nw.c1 : nw.c1;
    const src = soundAudio[key];
    if (src) playAudio(src, nwStatus);
    else speakSoundLabel(nw.c1);
  };
  document.getElementById("nwPlayVBtn").onclick = ()=>{
    speakSoundLabel(nw.v);
  };
  document.getElementById("nwPlayC2Btn").onclick = ()=>{
    // ending is a letter sound, approximate with speech
    speakSoundLabel(nw.c2);
  };

  // Vowel buttons (the pills inside nonsense panel)
  document.querySelectorAll("#nonsensePanel .pill[data-v]").forEach(btn=>{
    btn.onclick = ()=> setVowel(btn.dataset.v);
  });

  document.getElementById("nwCheckBtn").onclick = ()=>{
    const w = `${nw.c1}${nw.v}${nw.c2}`.toLowerCase();
    if (isBlocked(w)) {
      nwRealCheck.textContent = "ğŸš« Not allowed. Try another vowel!";
      return;
    }
    if (simpleRealWords.has(w)) {
      nwRealCheck.textContent = "âœ… That one is a REAL word!";
      addPhonicsStar();
    } else {
      nwRealCheck.textContent = "ğŸŒŸ Thatâ€™s a FUN nonsense word!";
      addPhonicsStar();
    }
  };

  // =========================================================
  // 6) NEW: Decodable Reading (by grade)
  // =========================================================
  const decTitle = document.getElementById("decTitle");
  const decFocus = document.getElementById("decFocus");
  const decText = document.getElementById("decText");
  const decQ = document.getElementById("decQ");
  const decChoices = document.getElementById("decChoices");
  const decResult = document.getElementById("decResult");

  let currentStory = null;

  const decodables = {
    "K": [
      {
        title:"Sam sat.",
        focus:"Focus: s, a, m (simple words)",
        text:"Sam sat. Sam sat on a mat. Sam is so glad.",
        q:"Where did Sam sit?",
        correct:"on a mat",
        choices:["on a mat","in a boat","in the rain"]
      },
      {
        title:"Tam and Tim",
        focus:"Focus: t, m, short vowels",
        text:"Tam sat. Tim sat. Tam and Tim tap.",
        q:"What do Tam and Tim do?",
        correct:"tap",
        choices:["tap","chop","ship"]
      }
    ],
    "1": [
      {
        title:"Ship or Chop",
        focus:"Focus: sh, ch, th",
        text:"The ship is big. I chop a stick. This is fun.",
        q:"What is big?",
        correct:"the ship",
        choices:["the ship","the chop","the stick"]
      },
      {
        title:"This and That",
        focus:"Focus: th",
        text:"This is my math. That is my map. This is that.",
        q:"What is my map?",
        correct:"that",
        choices:["that","ship","chop"]
      }
    ],
    "2": [
      {
        title:"Rain Day",
        focus:"Focus: long a (ai/ay)",
        text:"It may rain today. I wait and play a game. I stay and read.",
        q:"What might happen today?",
        correct:"rain",
        choices:["rain","snow","ship"]
      },
      {
        title:"Boat Ride",
        focus:"Focus: long o (oa/ow)",
        text:"I float in a boat. I row slow. The boat will go home.",
        q:"What do you float in?",
        correct:"a boat",
        choices:["a boat","a ship","a mat"]
      }
    ]
  };

  function pickStory(){
    const list = decodables[grade] || decodables["K"];
    currentStory = list[Math.floor(Math.random()*list.length)];
    decTitle.textContent = currentStory.title;
    decFocus.textContent = currentStory.focus;
    decText.textContent = currentStory.text;
    decQ.textContent = `Question: ${currentStory.q}`;
    decResult.textContent = "";
    renderDecChoices();
  }

  function renderDecChoices(){
    decChoices.innerHTML = "";
    const options = shuffle(currentStory.choices);
    options.forEach(opt=>{
      const card = document.createElement("div");
      card.className = "card";
      card.style.textAlign = "center";
      card.innerHTML = `<h3 style="font-size:22px; margin-bottom:6px;">${opt}</h3><p class="small">Tap!</p>`;
      card.onclick = ()=>{
        if (decResult.textContent) return;
        if (opt === currentStory.correct) {
          decResult.textContent = "Correct! â­";
          addPhonicsStar();
        } else {
          decResult.textContent = "Try again ğŸ™‚";
        }
      };
      decChoices.appendChild(card);
    });
  }

  document.getElementById("decPickBtn").onclick = pickStory;
  document.getElementById("decReadBtn").onclick = ()=>{
    if (!currentStory) return;
    speakText(currentStory.text);
  };
  document.getElementById("decStopBtn").onclick = stopSpeak;

  // ---------- init ----------
  renderGradeButtons();
  resetUI();

</script>

</body>
</html>
