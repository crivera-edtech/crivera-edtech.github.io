<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resources | BloomELearning âœ¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

<header>
  <div class="container">
    <div class="logo">BloomELearning âœ¨</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>

        <li class="dropdown">
          <a class="dropdown-toggle" href="#" aria-expanded="false">Subjects</a>
          <div class="dropdown-menu">
            <a href="phonics.html">ğŸ”¤ Phonics</a>
            <a href="reading.html">ğŸ“– Reading</a>
            <a href="math.html">â• Math</a>
          </div>
        </li>

        <li class="dropdown">
          <a class="dropdown-toggle" href="#" aria-expanded="false">Resources</a>
          <div class="dropdown-menu">
            <a href="resources.html">ğŸ¥ Kids Resources</a>
            <a href="parent-resources.html">ğŸ§‘â€ğŸ« Parent Resources</a>
            <a href="standards.html">ğŸ“˜ Standards (Kâ€“2)</a>
          </div>
        </li>

        <li class="dropdown">
          <a class="dropdown-toggle" href="#" aria-expanded="false">Student</a>
          <div class="dropdown-menu">
            <a href="student-login.html">ğŸ§’ Student Login</a>
            <a href="progress.html">ğŸ“Š My Progress</a>
            <a href="sticker-book.html">ğŸ“– Sticker Book</a>
          </div>
        </li>

        <li><a href="games.html">ğŸ® Games</a></li>
        <li><a href="diagnostic.html">ğŸ§  Diagnostic</a></li>
      </ul>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h1>Resources ğŸ¥ğŸ“š</h1>
    <p>Pick a grade, choose a category, and save your favorites â­</p>

    <div class="game-box wide" style="margin-top:16px;">
      <div class="kid-big" style="text-align:center;">Filters</div>

      <!-- Grade Toggle -->
      <div class="badge-row" style="justify-content:center;">
        <button class="pill active" data-grade="K">Kindergarten</button>
        <button class="pill" data-grade="1">Grade 1</button>
        <button class="pill" data-grade="2">Grade 2</button>
      </div>

      <!-- Category Toggle -->
      <div class="badge-row" style="justify-content:center; margin-top:12px;">
        <button class="pill active" data-filter="kids">Kids</button>
        <button class="pill" data-filter="parents">Parents</button>
        <button class="pill" data-filter="teachers">Teachers</button>
        <button class="pill" data-filter="printables">Printables</button>
        <button class="pill" data-filter="favorites">â­ Favorites</button>
      </div>

      <!-- Search + Safe Mode -->
      <div class="quick-strip" style="justify-content:center; margin-top:12px; flex-wrap:wrap;">
        <input
          id="search"
          type="text"
          placeholder="Search (phonics, read-aloud, ten-frame, brain break...)"
          style="width:min(680px,100%); padding:14px 16px; border-radius:999px; border:2px solid rgba(0,0,0,0.10); font-family:inherit; font-size:16px;"
        />
        <button class="btn secondary" id="clearSearch">Clear</button>

        <label class="btn secondary" style="display:flex; align-items:center; gap:10px; cursor:pointer;">
          <input id="safeMode" type="checkbox" style="width:18px; height:18px;" />
          Kids Safe Mode
        </label>
      </div>

      <div class="small" id="resultsMeta" style="text-align:center; margin-top:10px;"></div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">

    <!-- Recommended Path -->
    <h2 class="section-title">Recommended Path ğŸŒ¿</h2>
    <div class="game-box wide">
      <div class="grid-3" id="pathGrid"></div>
    </div>

    <!-- Featured -->
    <h2 class="section-title" style="margin-top:18px;">Featured ğŸŒŸ</h2>
    <div class="game-box wide">
      <div class="grid-3" id="featuredGrid"></div>
    </div>

    <!-- Main list -->
    <h2 class="section-title" style="margin-top:18px;">Browse</h2>
    <div class="game-box wide">
      <div class="grid-3" id="resourceGrid"></div>
    </div>

    <!-- Recently opened -->
    <div class="game-box wide" style="margin-top:16px;">
      <div class="kid-big">Recently Opened ğŸ•’</div>
      <p class="small">Saved on your device.</p>
      <div class="grid-3" id="recentGrid" style="margin-top:12px;"></div>
    </div>

  </div>
</section>

<footer>Â© 2026 BloomELearning âœ¨ | Made with ğŸ’š</footer>

<script src="./nav.js"></script>
<script>
  // =========================
  // Storage
  // =========================
  const FAV_KEY = "bloom_resource_favs";
  const RECENT_KEY = "bloom_resource_recent";
  const PROG_KEY = "bloom_progress";
  const PREF_GRADE_KEY = "bloom_pref_grade";
  const SAFE_MODE_KEY = "bloom_safe_mode";

  function load(key, fallback){
    try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
    catch { return fallback; }
  }
  function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

  function addProgressResourceOpen(){
    const p = load(PROG_KEY, { phonicsStars:0, readingStars:0, mathStars:0, tracingDone:0, gamesStars:0, resourcesOpened:0 });
    p.resourcesOpened = (p.resourcesOpened || 0) + 1;
    save(PROG_KEY, p);
  }

  // =========================
  // State
  // =========================
  let activeFilter = "kids";
  let query = "";
  let grade = localStorage.getItem(PREF_GRADE_KEY) || "K";
  let safeMode = !!load(SAFE_MODE_KEY, false);

  // =========================
  // Printables (add these files in your repo)
  // Folder: assets/printables/
  // =========================
  const PRINTABLES = [
    { id:"pr1", grade:["K","1"], type:"printables", kind:"printable", icon:"ğŸ–ï¸", title:"Letter Sounds Chart", tags:["phonics","chart","letter sounds"], length:"Printable", file:"assets/printables/letter-sounds-chart.png" },
    { id:"pr2", grade:["K","1"], type:"printables", kind:"printable", icon:"ğŸŸ©", title:"Ten-Frame Mat", tags:["math","ten frame","counting"], length:"Printable", file:"assets/printables/ten-frame-mat.png" },
    { id:"pr3", grade:["1","2"], type:"printables", kind:"printable", icon:"ğŸ§©", title:"Digraphs Poster (sh/ch/th)", tags:["phonics","digraphs"], length:"Printable", file:"assets/printables/digraphs-poster.png" },
    { id:"pr4", grade:["2"], type:"printables", kind:"printable", icon:"ğŸ’", title:"Vowel Teams (ai/ee/oa)", tags:["phonics","vowel teams"], length:"Printable", file:"assets/printables/vowel-teams-poster.png" },
    { id:"pr5", grade:["2"], type:"printables", kind:"printable", icon:"ğŸ§±", title:"Place Value (tens/ones)", tags:["math","place value"], length:"Printable", file:"assets/printables/place-value-chart.png" }
  ];

  // =========================
  // Curated resources
  // - safe: true means allowed in Kids Safe Mode
  // - grade: which grade(s) it fits
  // =========================
  const RESOURCES = [
    // --- Kids: Read-alouds (curated searches can be noisy; Safe Mode shows only curated items)
    { id:"ra1", grade:["K","1","2"], type:"kids", kind:"video", icon:"ğŸ“–", title:"Read-Aloud Corner (Kid Safe Picks)", tags:["read-aloud","story","listening"], length:"5â€“10 min", safe:true, url:"https://www.youtube.com/results?search_query=read+aloud+kids+picture+book" },

    // --- Kids: Phonics helpers
    { id:"ph1", grade:["K"], type:"kids", kind:"video", icon:"ğŸ”¤", title:"Letter Sounds Song (K)", tags:["phonics","letter sounds","k"], length:"3â€“4 min", safe:true, url:"https://www.youtube.com/results?search_query=letter+sounds+song+for+kids" },
    { id:"ph2", grade:["1"], type:"kids", kind:"video", icon:"ğŸ§©", title:"Digraphs Song (Grade 1)", tags:["phonics","digraphs","grade 1"], length:"3â€“5 min", safe:true, url:"https://www.youtube.com/results?search_query=digraphs+sh+ch+th+song+for+kids" },
    { id:"ph3", grade:["2"], type:"kids", kind:"video", icon:"ğŸ’", title:"Vowel Teams (Grade 2)", tags:["phonics","vowel teams","grade 2"], length:"4â€“6 min", safe:true, url:"https://www.youtube.com/results?search_query=vowel+teams+ai+ee+oa+for+kids" },

    // --- Kids: Math helpers
    { id:"ma1", grade:["K","1"], type:"kids", kind:"video", icon:"â•", title:"Counting with Movement (Kâ€“1)", tags:["math","counting","brain break"], length:"3â€“5 min", safe:true, url:"https://www.youtube.com/results?search_query=counting+movement+song+for+kids" },
    { id:"ma2", grade:["K","1"], type:"kids", kind:"video", icon:"ğŸŸ©", title:"Ten-Frame Practice (Kâ€“1)", tags:["math","ten frame","k","grade 1"], length:"4â€“6 min", safe:true, url:"https://www.youtube.com/results?search_query=ten+frame+practice+for+kids" },
    { id:"ma3", grade:["2"], type:"kids", kind:"video", icon:"ğŸ§±", title:"Place Value: Tens & Ones (2)", tags:["math","place value","grade 2"], length:"4â€“7 min", safe:true, url:"https://www.youtube.com/results?search_query=place+value+tens+ones+for+kids" },

    // --- Kids: Brain breaks
    { id:"bb1", grade:["K","1","2"], type:"kids", kind:"video", icon:"ğŸ’ƒ", title:"2-Minute Brain Break", tags:["brain break","movement"], length:"2 min", safe:true, url:"https://www.youtube.com/results?search_query=2+minute+brain+break+kids" },
    { id:"bb2", grade:["K","1","2"], type:"kids", kind:"video", icon:"ğŸ§˜", title:"Balloon Breathing (Calm)", tags:["mindfulness","calm"], length:"2â€“3 min", safe:true, url:"https://www.youtube.com/results?search_query=balloon+breath+for+kids" },

    // --- Parents
    { id:"pa1", grade:["K","1","2"], type:"parents", kind:"tool", icon:"ğŸ§‘â€ğŸ«", title:"Home Reading Routine (10 minutes)", tags:["parents","routine","reading"], length:"10 min", safe:true, url:"parent-resources.html" },
    { id:"pa2", grade:["K","1"], type:"parents", kind:"tool", icon:"ğŸŒ¿", title:"Phonics at Home: 3 Easy Games", tags:["parents","phonics"], length:"5â€“10 min", safe:true, url:"parent-resources.html" },
    { id:"pa3", grade:["K","1","2"], type:"parents", kind:"tool", icon:"â­", title:"Rewards Guide: Stars & Stickers", tags:["parents","rewards"], length:"2â€“3 min", safe:true, url:"sticker-book.html" },

    // --- Teachers
    { id:"te1", grade:["K","1","2"], type:"teachers", kind:"tool", icon:"ğŸ“˜", title:"Standards Quick View (Kâ€“2)", tags:["teachers","standards","planning"], length:"3â€“5 min", safe:true, url:"standards.html" },
    { id:"te2", grade:["K","1","2"], type:"teachers", kind:"video", icon:"ğŸ—‚ï¸", title:"Small Group Rotation Ideas", tags:["teachers","small groups","centers"], length:"5â€“8 min", safe:false, url:"https://www.youtube.com/results?search_query=small+group+rotations+k-2" }
  ];

  const FEATURED_IDS = ["bb1", "ph1", "ma2"];

  // =========================
  // Favorites + Recent
  // =========================
  function getFavs(){ return new Set(load(FAV_KEY, [])); }
  function setFavs(set){ save(FAV_KEY, Array.from(set)); }

  function getRecent(){ return load(RECENT_KEY, []); }
  function pushRecent(id){
    const r = getRecent().filter(x=>x !== id);
    r.unshift(id);
    save(RECENT_KEY, r.slice(0,6));
  }

  function toggleFav(id){
    const favs = getFavs();
    if (favs.has(id)) favs.delete(id);
    else favs.add(id);
    setFavs(favs);
    render();
  }

  function openItem(item){
    pushRecent(item.id);
    addProgressResourceOpen();

    const url = item.url || item.file;
    const isExternal = /^https?:\/\//i.test(url);

    if (isExternal) window.open(url, "_blank", "noopener,noreferrer");
    else window.location.href = url;

    renderRecent();
  }

  // =========================
  // Matching
  // =========================
  function matchesQuery(item){
    if (!query) return true;
    const hay = (item.title + " " + item.tags.join(" ") + " " + item.kind).toLowerCase();
    return hay.includes(query);
  }

  function matchesGrade(item){
    return !item.grade || item.grade.includes(grade);
  }

  function isAllowedInSafeMode(item){
    // In safe mode, only show items with safe:true
    // Also block youtube "search results" pages if you want later; keeping it simple now:
    return !!item.safe;
  }

  function getAllItems(){
    const printablesAsItems = PRINTABLES.map(p => ({
      ...p,
      url: p.file, // open local file
      safe: true
    }));

    return [...RESOURCES, ...printablesAsItems];
  }

  function filteredItems(){
    const all = getAllItems();
    const favs = getFavs();

    return all.filter(item => {
      // grade
      if (!matchesGrade(item)) return false;

      // safe mode
      if (safeMode && !isAllowedInSafeMode(item)) return false;

      // filter
      if (activeFilter === "favorites") {
        if (!favs.has(item.id)) return false;
      } else {
        if (item.type !== activeFilter) return false;
      }

      // query
      return matchesQuery(item);
    });
  }

  // =========================
  // Card HTML
  // =========================
  function cardHTML(item){
    const favs = getFavs();
    const isFav = favs.has(item.id);

    const isPrintable = item.type === "printables";
    const preview = isPrintable ? `
      <div style="margin-top:10px; border-radius:18px; overflow:hidden; border:2px solid rgba(0,0,0,0.06);">
        <img src="${item.file}" alt="${item.title}" style="width:100%; display:block;">
      </div>
    ` : "";

    return `
      <div class="card" style="display:flex; flex-direction:column; gap:10px;">
        <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px;">
          <div style="display:flex; gap:10px; align-items:flex-start;">
            <div style="font-size:28px; line-height:1;">${item.icon}</div>
            <div>
              <h3 style="margin:0 0 4px 0;">${item.title}</h3>
              <div class="small" style="opacity:.9;">
                <strong>Length:</strong> ${item.length}
              </div>
            </div>
          </div>

          <button class="btn secondary" data-fav="${item.id}" title="Favorite" aria-label="Favorite" style="padding:10px 12px;">
            ${isFav ? "â­" : "â˜†"}
          </button>
        </div>

        <div class="small" style="line-height:1.5;">
          <strong>Tags:</strong> ${item.tags.join(", ")}
        </div>

        ${preview}

        <div class="quick-strip" style="justify-content:flex-start; margin-top:auto;">
          <button class="btn" data-open="${item.id}">${isPrintable ? "Open Printable" : "Open"}</button>
          <button class="btn secondary" data-copy="${item.id}">Copy Link</button>
        </div>
      </div>
    `;
  }

  function wireButtons(scope){
    scope.querySelectorAll("[data-fav]").forEach(btn=>{
      btn.onclick = ()=> toggleFav(btn.dataset.fav);
    });

    scope.querySelectorAll("[data-open]").forEach(btn=>{
      btn.onclick = ()=>{
        const item = getAllItems().find(r=>r.id===btn.dataset.open);
        if (item) openItem(item);
      };
    });

    scope.querySelectorAll("[data-copy]").forEach(btn=>{
      btn.onclick = async ()=>{
        const item = getAllItems().find(r=>r.id===btn.dataset.copy);
        if (!item) return;
        const link = item.url || item.file;

        try {
          await navigator.clipboard.writeText(link);
          alert("Link copied!");
        } catch {
          const ta = document.createElement("textarea");
          ta.value = link;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          alert("Link copied!");
        }
      };
    });
  }

  // =========================
  // Recommended Path (grade-based)
  // =========================
  function getRecommendedPath(){
    // A simple, grade-based 1-2-3 flow
    if (grade === "K") return ["ph1", "ra1", "ma2"];
    if (grade === "1") return ["ph2", "ra1", "ma2"];
    return ["ph3", "ra1", "ma3"]; // grade 2
  }

  function renderPath(){
    const grid = document.getElementById("pathGrid");
    const ids = getRecommendedPath();

    const items = ids
      .map(id => getAllItems().find(x=>x.id===id))
      .filter(Boolean)
      .filter(x => (!safeMode || x.safe));

    grid.innerHTML = items.map(cardHTML).join("");
    wireButtons(grid);
  }

  // =========================
  // Featured / Main / Recent
  // =========================
  function renderFeatured(){
    const grid = document.getElementById("featuredGrid");
    const items = FEATURED_IDS
      .map(id => getAllItems().find(r=>r.id===id))
      .filter(Boolean)
      .filter(matchesGrade)
      .filter(x => (!safeMode || x.safe));

    grid.innerHTML = items.map(cardHTML).join("");
    wireButtons(grid);
  }

  function renderMain(){
    const grid = document.getElementById("resourceGrid");
    const items = filteredItems();

    const label =
      activeFilter === "favorites" ? "Favorites" :
      activeFilter === "printables" ? "Printables" :
      activeFilter;

    document.getElementById("resultsMeta").textContent =
      `${items.length} result${items.length===1?"":"s"} â€¢ Grade ${grade} â€¢ Showing: ${label}${safeMode ? " â€¢ Safe Mode ON" : ""}`;

    grid.innerHTML = items.map(cardHTML).join("") || `
      <div class="card" style="grid-column:1 / -1; text-align:center;">
        <div class="kid-big">No matches yet ğŸ™‚</div>
        <p class="small">Try a different search or switch categories.</p>
      </div>
    `;
    wireButtons(grid);
  }

  function renderRecent(){
    const grid = document.getElementById("recentGrid");
    const ids = getRecent();
    const items = ids
      .map(id => getAllItems().find(r=>r.id===id))
      .filter(Boolean)
      .filter(matchesGrade)
      .filter(x => (!safeMode || x.safe));

    if (!items.length){
      grid.innerHTML = `
        <div class="card" style="grid-column:1 / -1; text-align:center;">
          <div class="kid-big">Nothing opened yet!</div>
          <p class="small">Open a resource and it will show here.</p>
        </div>
      `;
      return;
    }

    grid.innerHTML = items.map(cardHTML).join("");
    wireButtons(grid);
  }

  function render(){
    renderPath();
    renderFeatured();
    renderMain();
    renderRecent();
  }

  // =========================
  // UI events
  // =========================
  // Grade pills
  document.querySelectorAll(".pill[data-grade]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      grade = btn.dataset.grade;
      localStorage.setItem(PREF_GRADE_KEY, grade);
      document.querySelectorAll(".pill[data-grade]").forEach(b=>{
        b.classList.toggle("active", b.dataset.grade === grade);
      });
      render();
    });
  });

  // Filter pills
  document.querySelectorAll(".pill[data-filter]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      activeFilter = btn.dataset.filter;
      document.querySelectorAll(".pill[data-filter]").forEach(b=>{
        b.classList.toggle("active", b.dataset.filter === activeFilter);
      });
      render();
    });
  });

  // Search
  const search = document.getElementById("search");
  search.addEventListener("input", ()=>{
    query = (search.value || "").trim().toLowerCase();
    render();
  });

  document.getElementById("clearSearch").onclick = ()=>{
    search.value = "";
    query = "";
    render();
  };

  // Safe mode
  const safeCb = document.getElementById("safeMode");
  safeCb.checked = safeMode;
  safeCb.addEventListener("change", ()=>{
    safeMode = safeCb.checked;
    save(SAFE_MODE_KEY, safeMode);
    render();
  });

  // Init active states
  document.querySelectorAll(".pill[data-grade]").forEach(b=>{
    b.classList.toggle("active", b.dataset.grade === grade);
  });

  render();
</script>

</body>
</html>
