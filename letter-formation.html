<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Letter Tracing | BloomELearning âœ¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

<header>
  <div class="container">
    <div class="logo">BloomELearning âœ¨</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li class="dropdown">
          <a href="#">Subjects</a>
          <div class="dropdown-menu">
            <a href="phonics.html">ğŸ”¤ Phonics</a>
            <a href="reading.html">ğŸ“– Reading</a>
            <a href="math.html">â• Math</a>
            <a href="letter-formation.html">âœï¸ Letter Tracing</a>
          </div>
        </li>
        <li class="dropdown">
          <a href="#">Resources</a>
          <div class="dropdown-menu">
            <a href="resources.html">ğŸ¥ Kids Resources</a>
            <a href="parent-resources.html">ğŸ§‘â€ğŸ« Parent Resources</a>
            <a href="standards.html">ğŸ“˜ Standards (Kâ€“2)</a>
          </div>
        </li>
        <li class="dropdown">
          <a href="#">Student</a>
          <div class="dropdown-menu">
            <a href="student-login.html">ğŸ§’ Student Login</a>
            <a href="progress.html">ğŸ“Š My Progress</a>
            <a href="sticker-book.html">ğŸ“– Sticker Book</a>
          </div>
        </li>
        <li><a href="games.html">ğŸ® Games</a></li>
        <li><a href="diagnostic.html">ğŸ§  Diagnostic</a></li>
      </ul>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="container">
    <h1>Letter Tracing âœï¸</h1>
    <p>Pick uppercase, lowercase, or numbers. Draw carefully and earn a sticker!</p>
    <div class="quick-strip">
      <a class="btn secondary" href="resources.html#tracing">Back to Resources</a>
      <a class="btn secondary" href="sticker-book.html">Sticker Book</a>
      <a class="btn secondary" href="progress.html">Progress</a>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="section-title">Trace Time! â­</h2>

    <div class="game-box wide">
      <div class="badge-row">
        <a class="pill" id="upperBtn" href="letter-formation.html?set=upper">ABC Uppercase</a>
        <a class="pill" id="lowerBtn" href="letter-formation.html?set=lower">abc Lowercase</a>
        <a class="pill" id="numsBtn"  href="letter-formation.html?set=nums">123 Numbers</a>
      </div>

      <div class="game-box" style="margin-top:14px;">
        <p class="kid-big">Trace this: <span id="bigChar" style="font-size:64px;">A</span></p>
        <p class="small" id="voiceTip">Press ğŸ”Š to hear how to write it.</p>

        <div class="quick-strip">
          <button class="btn secondary" id="speakBtn">ğŸ”Š How to write</button>
          <button class="btn secondary" id="clearBtn">Clear</button>
          <button class="btn" id="doneBtn">Finish & Earn Sticker</button>
        </div>

        <div class="canvas-wrap" style="margin-top:14px;">
          <canvas id="pad" width="900" height="400"></canvas>
        </div>

        <p class="kid-big" id="result" style="margin-top:14px;"></p>
        <p class="small">Tip: Use your finger on a phone/tablet.</p>
      </div>
    </div>
  </div>
</section>

<footer>Â© 2026 BloomELearning âœ¨ | Made with ğŸ’š</footer>

<script>
  const PROG_KEY = "bloom_progress";
  const STICKER_KEY = "bloom_sticker_book";

  function load(key, fallback){
    try { return JSON.parse(localStorage.getItem(key) || JSON.stringify(fallback)); }
    catch { return fallback; }
  }
  function save(key, obj){
    localStorage.setItem(key, JSON.stringify(obj));
  }
  function speak(text){
    if (!("speechSynthesis" in window)) return;
    speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 0.95;
    speechSynthesis.speak(u);
  }

  const params = new URLSearchParams(location.search);
  const set = params.get("set") || "upper";

  const sets = {
    upper: "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),
    lower: "abcdefghijklmnopqrstuvwxyz".split(""),
    nums:  "0123456789".split("")
  };

  const stickerChoices = ["â­","ğŸŒˆ","ğŸ¦„","ğŸ¦‰","ğŸ¦–","ğŸ€","ğŸŒ¼","ğŸ“","ğŸˆ","ğŸ’š"];

  let list = sets[set] || sets.upper;
  let idx = 0;

  const bigChar = document.getElementById("bigChar");
  const result = document.getElementById("result");

  // highlight pills
  function setActive(){
    document.getElementById("upperBtn").classList.toggle("active", set === "upper");
    document.getElementById("lowerBtn").classList.toggle("active", set === "lower");
    document.getElementById("numsBtn").classList.toggle("active", set === "nums");
  }
  setActive();

  function currentChar(){
    return list[idx % list.length];
  }

  function instructionFor(ch){
    if (set === "nums") return `Letâ€™s write the number ${ch}. Start at the top and go slowly.`;
    const name = ch.toLowerCase() === ch ? `lowercase ${ch}` : `uppercase ${ch}`;
    return `Letâ€™s write ${name}. Start at the top. Use slow, smooth lines.`;
  }

  function render(){
    bigChar.textContent = currentChar();
    result.textContent = "";
  }

  // Canvas drawing
  const canvas = document.getElementById("pad");
  const ctx = canvas.getContext("2d");

  function resizeCanvas(){
    // keep internal resolution but fit container width
    const rect = canvas.getBoundingClientRect();
    // draw style
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.lineWidth = 10;
    ctx.strokeStyle = "#2c7d5d";
  }

  let drawing = false;
  let last = null;

  function getPos(e){
    const rect = canvas.getBoundingClientRect();
    const touch = e.touches && e.touches[0];
    const clientX = touch ? touch.clientX : e.clientX;
    const clientY = touch ? touch.clientY : e.clientY;
    return { x: (clientX - rect.left) * (canvas.width / rect.width),
             y: (clientY - rect.top) * (canvas.height / rect.height) };
  }

  function startDraw(e){
    drawing = true;
    last = getPos(e);
    e.preventDefault();
  }

  function moveDraw(e){
    if (!drawing) return;
    const pos = getPos(e);
    ctx.beginPath();
    ctx.moveTo(last.x, last.y);
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
    last = pos;
    e.preventDefault();
  }

  function endDraw(){
    drawing = false;
    last = null;
  }

  canvas.addEventListener("mousedown", startDraw);
  canvas.addEventListener("mousemove", moveDraw);
  window.addEventListener("mouseup", endDraw);

  canvas.addEventListener("touchstart", startDraw, { passive:false });
  canvas.addEventListener("touchmove", moveDraw, { passive:false });
  canvas.addEventListener("touchend", endDraw);

  document.getElementById("clearBtn").onclick = ()=>{
    ctx.clearRect(0,0,canvas.width,canvas.height);
    result.textContent = "";
  };

  document.getElementById("speakBtn").onclick = ()=>{
    const ch = currentChar();
    speak(instructionFor(ch));
  };

  document.getElementById("doneBtn").onclick = ()=>{
    // earn sticker + update progress
    const ch = currentChar();
    const emoji = stickerChoices[Math.floor(Math.random()*stickerChoices.length)];
    const stickers = load(STICKER_KEY, []);
    stickers.push({ emoji, item: `Traced ${ch}`, perfect: true, time: Date.now() });
    save(STICKER_KEY, stickers);

    const prog = load(PROG_KEY, { phonicsStars:0, readingStars:0, mathStars:0, tracingDone:0, gamesStars:0, diagnosticScore:null });
    prog.tracingDone = (prog.tracingDone || 0) + 1;
    save(PROG_KEY, prog);

    result.textContent = `Nice! You earned a sticker ${emoji} ğŸ‰`;
    speak(`Great job! You earned a sticker!`);

    // next item
    idx++;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    render();
  };

  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();
  render();
</script>

</body>
</html>
